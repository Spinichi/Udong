# 우동 (UDONG) 외부 서비스 연동 정보

## 개요

우동 프로젝트에서 사용하는 외부 서비스들의 상세 정보 및 연동 방법을 정리한 문서입니다.

---

## 1. SSAFY 금융 API (FinAPI)

### 1.1 서비스 개요

- **서비스명**: SSAFY 금융교육 API
- **용도**: 가상 계좌 관리, 이체, 잔액 조회 등 금융 거래 시뮬레이션
- **베이스 URL**: `https://finopenapi.ssafy.io/ssafy/api/v1`

### 1.2 주요 기능

- 사용자 키(UserKey) 생성 및 관리
- 수시입출금 계좌 생성
- 계좌 이체 (더치페이, 회비 납부)
- 계좌 잔액 조회
- 거래 내역 조회

### 1.3 설정 정보

```yaml
finapi:
  base-url: https://finopenapi.ssafy.io/ssafy/api/v1
  userkey-path: /member/search
  api-key: ${FIN_API_KEY}
  institution-code: "00100" # 싸피은행
  app-no: "001" # 앱 번호
```

### 1.4 환경변수

```properties
FIN_API_KEY=[SSAFY에서 발급받은 API 키]
```

### 1.5 사용 클래스

- `FinApiClient.java` - 일반 금융 API 호출
- `FinEduClient.java` - 교육용 API 호출
- `DutchpayService.java` - 정산 이체 처리
- `ClubDuesService.java` - 회비 처리
- `ClubFundQueryService.java` - 계좌 조회

### 1.6 API 엔드포인트

- **UserKey 조회**: `/edu/member/userKey`
- **계좌 이체**: `/edu/demandDeposit/updateDemandDepositAccountTransfer`
- **잔액 조회**: `/edu/demandDeposit/inquireDemandDepositAccount`

---

## 2. Google Fonts

### 2.1 서비스 개요

- **서비스명**: Google Fonts
- **용도**: 웹 폰트 제공 (한글 폰트)
- **베이스 URL**: `https://fonts.googleapis.com`

### 2.2 사용 폰트

- **Gowun Dodum** - 본문 텍스트용
- **Jua** - 제목 및 강조 텍스트용
- **Gamja Flower** - 장식용 텍스트

### 2.3 로딩 방식

```html
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
  href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&family=Jua&family=Gamja+Flower&display=swap"
  rel="stylesheet"
/>
```

---

## 3. GMS (SSAFY) - AI 서비스

### 3.1 서비스 개요

- **서비스명**: GMS (SSAFY AI Gateway)
- **용도**: AI 채팅 및 이미지 생성
- **베이스 URL**: `https://gms.ssafy.io`

### 3.2 주요 기능

#### 3.2.1 AI 채팅 (ChatGPT)

- **엔드포인트**: `/gmsapi/api.openai.com/v1/chat/completions`
- **모델**: gpt-4o
- **용도**: MT 일정 생성, 채팅 AI 응답

#### 3.2.2 이미지 생성 (Imagen)

- **엔드포인트**: `/gmsapi/generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict`
- **모델**: Imagen 3.0
- **용도**: 동아리 마스코트 이미지 생성

### 3.3 설정 정보

```yaml
# AI 채팅
app:
  gms:
    model: gpt-4o

# 이미지 생성
imagen:
  endpoint: "https://gms.ssafy.io/gmsapi/generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict?key=${IMA_GMS_KEY}"
```

### 3.3 환경변수

```properties
GMS_KEY=[GMS API 인증 토큰]
IMA_GMS_KEY=[Imagen API 키]
CHAT_ENDPOINT=https://gms.ssafy.io/gmsapi/api.openai.com/v1/chat/completions
```

### 3.4 사용 클래스

- `GmsChatClient.java` - AI 채팅 클라이언트
- `MascotImageService.java` - 이미지 생성 서비스

---

## 4. AWS S3

### 4.1 서비스 개요

- **서비스명**: Amazon S3 (Simple Storage Service)
- **용도**: 파일 저장 (영수증 이미지, 마스코트 이미지 등)
- **리전**: ap-southeast-2 (시드니)

### 4.2 주요 기능

- 영수증 이미지 업로드 (더치페이)
- 마스코트 이미지 저장
- 공개 URL을 통한 이미지 접근

### 4.3 설정 정보

```yaml
cloud:
  aws:
    region: ap-southeast-2
```

### 4.4 환경변수

```properties
AWS_ACCESS_KEY_ID=[AWS 액세스 키]
AWS_SECRET_ACCESS_KEY=[AWS 시크릿 키]
AWS_REGION=ap-southeast-2
```

### 4.5 버킷 구조

```
S3 버킷/
├── dutchpay/
│   ├── general/receipts/    # 일반 정산 영수증
│   └── {eventId}/receipts/  # 이벤트별 정산 영수증
└── mascots/                 # 마스코트 이미지
    └── {clubId}/
```

### 4.6 사용 클래스

- `S3Config.java` - S3 클라이언트 설정
- `S3Uploader.java` - 파일 업로드 유틸
- `MascotImageService.java` - 마스코트 이미지 처리
- `DutchpayService.java` - 영수증 업로드

### 4.7 파일 명명 규칙

- **영수증**: `{prefix}/{scope}/receipts/{ULID}.png`
- **마스코트**: `mascots/{clubId}/{filename}`

---

## 5. SSAFY 도메인 서비스

### 5.1 서비스 개요

- **도메인**: `j13a310.p.ssafy.io`
- **용도**: HTTPS SSL 인증서 및 도메인 제공
- **SSL**: Let's Encrypt (Certbot)

### 5.2 설정 정보

```nginx
server_name j13a310.p.ssafy.io udong.shop www.udong.shop;
ssl_certificate /etc/letsencrypt/live/j13a310.p.ssafy.io/fullchain.pem;
ssl_certificate_key /etc/letsencrypt/live/j13a310.p.ssafy.io/privkey.pem;
```

### 5.3 CORS 설정

```java
@CrossOrigin(origins = {
    "http://localhost:5173",
    "https://j13a310.p.ssafy.io",
    "https://udong.shop",
    "https://www.udong.shop"
})
```

---

## 6. 서비스별 의존성 정보

### 6.1 백엔드 의존성 (build.gradle)

```gradle
// AWS S3
implementation platform("software.amazon.awssdk:bom:2.25.68")
implementation "software.amazon.awssdk:s3"

// HTTP 클라이언트 (GMS 통신용)
implementation 'com.squareup.okhttp3:okhttp:4.11.0'
implementation 'org.springframework.boot:spring-boot-starter-webflux'
```

### 6.2 환경변수 요약

```properties
# 금융 API
FIN_API_KEY=

# AI 서비스
GMS_KEY=
IMA_GMS_KEY=
CHAT_ENDPOINT=

# AWS S3
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
AWS_REGION=
```

---

## 7. 보안 고려사항

### 7.1 API 키 관리

- 모든 API 키는 환경변수로 관리
- Git에서 .env 파일 제외
- Jenkins Credentials를 통한 보안 배포

### 7.2 CORS 설정

- 특정 도메인만 허용
- 개발/운영 환경별 도메인 분리

### 7.3 SSL/TLS

- HTTPS 강제 사용
- Let's Encrypt 자동 갱신

---

## 8. 장애 대응

### 8.1 금융 API 장애 시

- 응답 코드 확인 (H0000 = 성공)
- 타임아웃 설정 (90초)
- 재시도 로직 없음 (금융 거래 특성상)

### 8.2 S3 업로드 실패 시

- 이미지 압축 및 형식 변환 (PNG)
- 파일 크기 제한 (5MB)
- ULID 기반 고유 파일명

### 8.3 AI 서비스 장애 시

- 1차: JSON 형식 응답 요청
- 2차: 일반 텍스트 응답으로 폴백
- 타임아웃: 60초
